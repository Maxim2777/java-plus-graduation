# Комментарии (Comments)

Функциональность комментариев позволяет пользователям оставлять отзывы к **опубликованным событиям**, а администраторам — управлять содержанием комментариев.

---

## Эндпоинты

### Private API `/users/{userId}/comments`

#### `POST /users/{userId}/comments`

> Создание нового комментария к событию.

- **Кто может вызывать:** авторизованный пользователь
- **Что делает:** добавляет комментарий от имени пользователя `userId` к опубликованному событию
- **Тело запроса (JSON):**
```json
{
  "eventId": 10,
  "text": "Отличное мероприятие!"
}
```
- **Ответ:** `201 Created`, `CommentDto`

---

#### `GET /users/{userId}/comments`

> Получение всех комментариев, созданных пользователем.

- **Кто может вызывать:** авторизованный пользователь
- **Что делает:** возвращает список комментариев, созданных этим пользователем (пагинация: `from`, `size`)
- **Параметры:** `?from=0&size=10`

---

#### `DELETE /users/{userId}/comments/{commentId}`

> Удаление своего комментария.

- **Кто может вызывать:** авторизованный пользователь
- **Что делает:** удаляет комментарий, если он принадлежит пользователю `userId`
- **Ответ:** `204 No Content`

---

#### `PATCH /users/{userId}/comments/{commentId}`

> Обновление собственного комментария.

- **Кто может вызывать:** авторизованный пользователь
- **Что делает:** обновляет текст ранее созданного комментария
- **Тело запроса (JSON):**
```json
{
  "text": "Обновлённый текст комментария"
}
```
- **Ответ:** `200 OK`, `CommentDto`

---

### Public API `/events/{eventId}/comments`

#### `GET /events/{eventId}/comments`

> Получение всех комментариев к событию.

- **Кто может вызывать:** любой пользователь (публично)
- **Что делает:** возвращает список комментариев к событию `eventId`, отсортированный по дате (новые — первыми)
- **Параметры:** `?from=0&size=10`

---

### Admin API `/admin/comments`

#### `GET /admin/comments`

> Получение всех комментариев с фильтрацией по автору, событию и диапазону дат.

- **Кто может вызывать:** администратор
- **Что делает:** возвращает список комментариев с возможной фильтрацией:
    - `authorId` — ID пользователя (автора комментария)
    - `eventId` — ID события
    - `rangeStart` и `rangeEnd` — временной диапазон `yyyy-MM-dd HH:mm:ss`
    - `from`, `size` — параметры пагинации

- **Пример запроса:**
```
GET /admin/comments?authorId=1&eventId=10&rangeStart=2025-01-01 00:00:00&rangeEnd=2025-12-31 23:59:59&from=0&size=20
```

- **Ответ:** `200 OK`, список `CommentDto`

---

#### `DELETE /admin/comments/{commentId}`

> Удаление любого комментария (модерация).

- **Кто может вызывать:** администратор
- **Что делает:** позволяет удалить любой комментарий по ID — используется при нарушении правил

---

## Требования и ограничения

- Комментарии можно оставлять **только к событиям в статусе `PUBLISHED`**
- Максимальная длина комментария: **500 символов**
- Один пользователь может оставить **несколько комментариев** к одному событию
- Только **автор комментария** может удалить или редактировать свой комментарий
- **Администратор** может удалить любой комментарий

---

## Примеры запросов

```bash
curl -X POST http://localhost:8080/users/1/comments \
-H "Content-Type: application/json" \
-d '{"eventId": 10, "text": "Супер!"}'
```

```bash
curl http://localhost:8080/events/10/comments
```

```bash
curl -X PATCH http://localhost:8080/users/1/comments/5 \
-H "Content-Type: application/json" \
-d '{"text": "Обновлённый текст"}'
```

```bash
curl -X DELETE http://localhost:8080/users/1/comments/5
```

```bash
curl "http://localhost:8080/admin/comments?authorId=1&from=0&size=10"
```